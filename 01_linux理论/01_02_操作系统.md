
https://zhuanlan.zhihu.com/p/676421966



# 2 系统调用与库函数的区别

系统调用(System call)是程序向系统内核请求服务的方式。可以包括硬件相关的服务(例如， 访问硬盘等)，或者创建新进程，调度其他进程等。系统调用是程序和操作系统之间的重要接 口。
库函数：把一些常用的函数编写完放到一个文件里，编写应用程序时调用，这是由第三方提供 的，发生在用户地址空间。
在移植性方面，不同操作系统的系统调用一般是不同的，移植性差；而在所有的ANSI C编译器 版本中，C库函数是相同的。
在调用开销方面，系统调用需要在用户空间和内核环境间切换，开销较大；而库函数调用属于 “过程调用”，开销较小。

# 3 段页式内存管理有何优点？

段页式内存管理结合了段式内存管理和页式内存管理的优点，提供了灵活性、保护性、共享性和虚拟化支持。
灵活性：将内存划分为段和页的组合，既可以方便地管理不同类型的程序和数据，又可以细致地进行内存分配和利用。
保护性：通过设置段和页的访问权限，可以对内存进行精细的访问控制，保护数据的安全性。
共享性：段页式内存管理支持多个程序共享同一段或同一页面，减少内存重复存储，提高内存利用效率。
虚拟化支持：通过页表和页面地址转换，实现虚拟地址到物理地址的映射，为虚拟内存提供支持，提高系统的内存容量和隔离性。

# 4 系统调用read()/write()，内核具体做了哪些事情

- 用户空间发起read()/write()系统调用，并将参数传递给内核。
- 内核根据系统调用号找到相应的内核函数进行处理，如sys_read()/sys_write()。
- 内核根据文件描述符找到对应的文件对象，并执行读取或写入操作。
- 在读取操作中，内核将数据从文件或设备读取到内核空间，并通过页缓存层进行管理。
- 在写入操作中，内核将数据从用户空间拷贝到内核空间，并通过文件系统层将数据写入文件或设备。
- 内核可能会通过缓存管理、块设备管理和驱动程序等层次对数据进行处理和传输。

处理完成后，内核将结果返回给用户空间，并用户空间继续执行下一步操作。

# 5 内存对齐的原理

1. 内存对齐规则：根据平台和编译器的不同，对于不同类型的变量有着不同的内存对齐要求。常见的对齐要求是按照变量大小（字节）进行对齐，比如整型通常需要按4字节或8字节对齐。
2. 结构体成员对齐：结构体中各个成员的内存布局也需要满足对齐规则。编译器会自动在结构体成员之间填充空白字节，使得每个成员相对于结构体首地址的偏移量是它自身大小的倍数。
3. 对齐补齐：为了保证数据类型按照规定字节数被访问，在某些情况下可能会在变量末尾添加额外的空白字节来补充，以达到所需的最小对齐要求。

**内存对齐的优点包括：**

- 提高访问效率：CPU可以更快地读取和写入符合特定对齐要求的数据。
- 避免跨界访问：当数据没有按照对齐要求存储时，可能导致额外的CPU开销和异常情况。

需要注意的是，内存对齐可能会增加内存消耗。当结构体成员存在不同类型或大小的变量时，编译器为了满足最大对齐要求而插入的填充字节会占用一定的额外空间。因此，在设计结构体时需要权衡内存占用和访问效率之间的平衡。

# 6 进程和线程的区别，同步和锁的使用

1. 进程（Process）：一个进程是指正在运行的程序实例，每个进程都有独立的内存空间、执行环境和资源。进程之间相互隔离，通信需要通过特定的机制进行。每个进程都有自己的地址空间和系统资源，进程之间切换开销较大。
2. 线程（Thread）：线程是一个轻量级的执行单元，存在于进程中。多个线程可以在同一进程中共享相同的内存空间和资源。线程之间切换开销较小，可以更高效地利用CPU。

## 6.1 同步和锁则是并发编程中常用的工具，用于协调多个线程或者进程之间的访问：

1. 同步（Synchronization）：同步用于确保多个线程或者进程按照某种顺序执行以避免竞态条件和数据不一致问题。常见的同步机制包括信号量、条件变量、事件等，在并发环境下控制访问顺序和互斥操作。
2. 锁（Lock）：锁是一种机制，用于提供对共享资源的独占访问权。在多线程或者多进程环境下，使用锁可以确保同一时间只有一个线程或者进程可以访问共享资源，防止竞态条件和数据不一致问题的发生。常见的锁包括互斥锁、读写锁等。

同步和锁的使用可以避免多个线程或者进程同时修改共享资源而导致的数据不一致性问题。通过合理地设计同步机制和加锁策略，可以保证并发程序的正确性和稳定性。然而，过度的同步和过多的加锁会带来额外的开销，降低并发性能，因此在实际应用中需要谨慎考虑并发控制策略。

## 6.2 进程和线程的区别**

**定义**：
- 进程：一个进程可以理解为一个正在执行中的程序实例。它具有独立的内存空间、运行环境和资源。
- 线程：线程是进程中的执行单元。一个进程可以包含多个线程，它们共享同一份内存空间和资源。

**资源占用：**
- 进程：每个进程都有自己独立的地址空间，需要分配相应的系统资源，如内存、文件描述符等。
- 线程：线程属于同一个进程，共享该进程的地址空间和资源。因此，创建线程比创建进程更轻量级。

**切换开销：**
- 进程：由于每个进程都有独立的地址空间，进行进程切换时需要保存当前进度上下文，并加载新的进度上下文，切换开销较大。
- 线程：由于线程共享同一份地址空间和资源，进行线程切换时只需保存和恢复少量寄存器状态即可，切换开销较小。

**通信与同步：**
- 进程：不同进程之间通信复杂且开销较大。常见的进程间通信（IPC）方式包括管道、消息队列、共享内存等。
- 线程：线程之间共享同一份地址空间，可以直接读写共享变量来进行通信。此外，线程之间可以通过锁和同步机制实现数据的同步与互斥。

**并发性：**
- 进程：不同进程之间是并发执行的，即使是单核处理器也能通过时间片轮转实现进程切换。
- 线程：线程是在进程内部并发执行的，多个线程可以同时运行在多个核心上，并且具有更高的响应速度。


# 7 并发和并行 

如果从英文字典对它们的解释也没有多大区别，差不多都是说同是发生，但字面上 Parallel 多了一个平行的意思。所以在中文上，在计算机领域我们约定的翻译是

    Concurrent(Concurrency)  --  并发
    Parallel(Parallelism)           --  并行


并发：多个任务在同一个 CPU 核上按细分的时间片轮流(交替)执行，从逻辑上来看那些任务是同时执行。针对 CPU 内核来说，任务仍然是按细粒度的串行执行。也难怪在 Java 5 中新加的并发 API 的包名是 java.uti.concurrent。

并行：区别与串行，多个任务真正的分配到不同的 CPU 内核上去执行的，它们是真正的同时执行。注意到 Java 8 的  Collection 除了 stream() 方法外，还有个方法名字叫做  parallelStream(), 为什么它是 parallel 呢？因为它使用的线程池是 ForkJoinPool.commonPool, 而这个池的大小是 CPU 内核数减一，主线程已经占了一个核，希望 的是 parallelStream() 中每个任务都能理想的分配到不同的 CPU 内核上去并行执行。

更通俗一点的类比，并发是四辆汽车在同一个车道上跑; 并行是单向四车道，四辆车在各自的车道跑，彼此不受影响。

# 8 优先级反转和优先级继承的概念

优先级反转（Priority Inversion）和优先级继承（Priority Inheritance）是多任务操作系统中解决优先级相关问题的两种机制。

1. 优先级反转：当一个低优先级任务持有一个高优先级任务所需的资源时，由于资源被占用，高优先级任务无法运行。如果此时又有一个中间优先级的任务等待该低优先级任务释放资源，就会导致高优先级任务一直等待，即发生了优先级反转。这种情况下，低优先级任务实际上拖延了高优先级任务的执行。
2. 优先级继承：为了解决优先级反转问题，引入了优先级继承机制。当一个低优先级任务获取到一个高优先级任务所需的资源时，该资源会被标记为继承者的最高优先级。这样，在中间或者较低的其他任务请求同样的资源时，它们的实际执行顺序会被提升到继承者的最高优先级。这样一来，可以确保高优先级任务能够及时执行。

通过使用优先级继承机制，可以避免由于低优先级任务持有关键资源而导致的高优先级任务被阻塞或延迟执行的问题。这种机制有效地解决了优先级反转的影响，并提高了系统的可靠性和实时性。但需要注意，优先级继承也可能引入其他问题，如死锁和优先级反转链等，因此在设计和使用中需要谨慎考虑。

# 9 SPI总线协议

SPI（Serial Peripheral Interface）是一种常用的串行通信接口协议，它用于在微控制器或其他数字集成电路之间进行数据交换。SPI总线协议具有以下特点：

1. 架构：SPI使用主从架构，其中一个设备作为主设备，其他设备作为从设备。
2. 通信方式：SPI使用全双工通信方式，意味着主设备和从设备可以同时发送和接收数据。
3. 传输线数量：SPI需要4条线来进行通信：

- SCLK（时钟线）：由主设备提供的时钟信号，同步主从设备的数据传输。
- MOSI（主输出从输入线）：主设备将数据发送给从设备。
- MISO（主输入从输出线）：从设备将数据返回给主设备。
- SS（片选线）：由主设备选择要与之通信的特定从设备。

数据传输顺序：SPI可以以不同的模式传输数据，包括CPOL（时钟极性）和CPHA（时钟相位）。这两个参数决定了在时钟边沿何时进行数据采样和传输。

数据帧格式：每个数据帧由一个控制位和一个或多个数据位组成。控制位用于指示该帧是否为有效数据，并可能包含附加信息。

速度调节：SPI总线的速度可以通过调整时钟频率来控制，以满足不同设备的需求。

SPI总线协议在许多应用中得到广泛使用，如传感器接口、存储器接口和外围设备接口等。它提供了高速、简单和可靠的数据传输方式，适合于短距离通信，并且对硬件要求相对较低。

# 10 I2C总线协议

I2C（Inter-Integrated Circuit）是一种常用的串行通信接口协议，用于在数字集成电路之间进行数据交换。I2C总线协议具有以下特点：

1. 架构：I2C使用主从架构，其中一个设备作为主设备，其他设备作为从设备。
2. 通信方式：I2C使用半双工通信方式，意味着主设备和从设备不能同时发送和接收数据。
3. 传输线数量：I2C只需要两条线来进行通信：

- SDA（串行数据线）：用于传输数据。
- SCL（串行时钟线）：由主设备提供的时钟信号，同步主从设备的数据传输。

数据传输顺序：在I2C总线上，数据是按字节进行传输的。每个字节都有一个位来指示是读操作还是写操作。通信始终由主设备启动，并以停止条件结束。
地址分配：每个从设备都有一个唯一的7位或10位地址，使得主设备可以选择要与之通信的特定从设备。
速度调节：I2C总线支持多种速度模式，例如标准模式、快速模式和高速模式。时钟频率可以通过配置来调整以满足不同速度要求。
多主机环境支持：I2C允许多个主设备在同一个总线上进行通信，使用仲裁机制解决同时发起通信的冲突问题。

I2C总线协议在许多应用中得到广泛使用，如传感器接口、存储器接口、外围设备接口和实时时钟等。它提供了简单、灵活和可靠的数据传输方式，并且支持多个设备在同一总线上进行通信。